{"name":"Rails db script helper","tagline":"a script helper make your db script clear and easy to be maintained. ","body":"# rails_db_script_helper\r\n\r\n\r\nThis is a single file helper to make your script easy to be written and read. I used it in my daily job.\r\n\r\n# Principal\r\n\r\n\r\n- Single File to apply minimalism\r\n- No dependency except std lib / Rails\r\n- Command Line parameter friendly\r\n- Optional Prompty for opitons\r\n- Confirm before submit transaction\r\n\r\n\r\n# Example Script\r\n\r\n```ruby\r\nrequire File.join(File.dirname(__FILE__), '..', 'db_script_helper')\r\n\r\n# script topic and detail description\r\ndesc \"User Fix\", \"Propose : Fix user data if user is invalid\" do \r\n\r\n  # require parameter of company id, if passed by parameters, will ignore prompty\r\n  param :company, \"Company ID\", :required => true\r\n\r\n  # you can define different data set to update\r\n  change_set :invalid_users do\r\n    #return could be one record or array of record\r\n    User.find_all_by_company_id params[:company]\r\n  end\r\n\r\n  # update data set you asked\r\n  update :invalid_users do |rec|\r\n    rec.is_deleted = true\r\n  end\r\n  # it will show all change set and confirm with Y/N\r\n\r\n  # a summary is a good change data report\r\n  summary :invalid_users do |result|\r\n    puts result\r\n  end\r\nend\r\n```\r\n\r\n\r\n\t\r\n# Execution\r\n\r\n\tcd rails_app_path\r\n\tscript/runner example_path.rb [options]\r\n\r\n# Example Output\r\n\r\n\t================================================================================\r\n\t                                    User Fix\r\n\t================================================================================\r\n\tPropose : Fix user data if user is invalid\r\n\t================================================================================\r\n\tCompany ID : 12\r\n\t================================================================================\r\n\t                                   Processing\r\n\t================================================================================\r\n\tusers : 36\r\n\t     +-is_deleted : false -> true\r\n\tusers : 40\r\n\t     +-is_deleted : false -> true\r\n\tusers : 84\r\n\t     +-is_deleted : false -> true\r\n\tusers : 85\r\n\t     +-is_deleted : false -> true\r\n\tusers : 86\r\n\t     +-is_deleted : false -> true\r\n\t================================================================================\r\n\t[Y]es / [N]o :N\r\n\t================================================================================\r\n\t                             QUIT without changing\r\n\t================================================================================\r\n\r\n# Tips\r\n\r\n# Authors\r\n\r\n\r\nGene Wu\r\n\r\n\r\n\r\nLicense\r\n=======\r\nMIT","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}